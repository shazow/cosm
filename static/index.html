<html>
<head>
<script>

    let pc = new RTCPeerConnection({
      iceServers: [
        {
          urls: 'stun:stun.l.google.com:19302'
        }
      ]
    })

    pc.onsignalingstatechange = e => console.log("onsignalstatechane", pc.signalingState)
    pc.oniceconnectionstatechange = e => console.log("oniceconnectionstatechange", pc.iceConnectionState)

    pc.ondatachannel = e => {
      let dc = e.channel
      console.log('New DataChannel ' + dc.label)
      dc.onclose = () => console.log('dc has closed')
      dc.onopen = () => console.log('dc has opened')
      dc.onmessage = (e) => console.log("dc.onmessage", dc.label, e.data);
      window.sendMessage = () => {
        dc.send(message)
      }
    }

    window.onload = async () => {
        const offer = await pc.createOffer();
        pc.setLocalDescription(offer);
        const encodedOffer = btoa(JSON.stringify({
            type: "offer",
            sdp: pc.localDescription,
        }));
        const r = await fetch("/rtc?offer=" + encodedOffer);
        console.log(r)
    }

</script>
</head>
<body>

    Cosm.

</body>
</html>
